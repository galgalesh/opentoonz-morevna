name: opentoonz-morevna
version: "v1.2.0.3"
summary: OpenToonz - Morevna Edition
description: |
  Published by DWANGO, OpenToonz is based on Toonz Studio Ghibli Version,
  originally developed in Italy by Digital Video, Inc., and customized
  by Studio Ghibli over many years of production.

base: core18

confinement: strict
grade: stable

apps:
  opentoonz-morevna:
    environment:
      LD_LIBRARY_PATH: "$SNAP/usr/lib/$SNAPCRAFT_ARCH_TRIPLET/pulseaudio:$LD_LIBRARY_PATH"
    command: desktop-launch $SNAP/bin/opentoonz
    plugs:
      - desktop
      - desktop-legacy
      - x11
      - unity7
      - opengl
      - network
      - network-manager
      - home
      - removable-media
      - pulseaudio
  tcleanup:
    command: tcleanup
    plugs:
      - home
  tcomposer:
    command: tcomposer
    plugs:
      - home
  tconverter:
    command: tconverter
    plugs:
      - home
  tfarmcontroller:
    command: tfarmcontroller
    plugs:
      - home
  tfarmserver:
    command: tfarmserver
    plugs:
      - home

parts:
  libmypaint:
    source: https://github.com/mypaint/libmypaint.git
    source-tag: 'v1.3.0'
    plugin: autotools
    build-packages:
      - build-essential
      - python2.7
      - autotools-dev
      - intltool
      - gettext
      - libtool
      - libjson-c-dev
      - libgirepository1.0-dev
      - libglib2.0-dev
  opentoonz-morevna:
    after: [libmypaint, desktop-qt5]
    plugin: cmake
    source: https://github.com/morevnaproject/opentoonz.git
    source-type: git
    source-tag: 'v1.2.0.3-morevna'
    build: |
      cd thirdparty/tiff-4.0.3
      ./configure --with-pic --disable-jbig
      make
      cd ../../
      mkdir build
      cd build
      cmake ../toonz/sources
      make
    install: |
      cp -a build/bin $SNAPCRAFT_PART_INSTALL/
      cp -a build/lib/opentoonz/ $SNAPCRAFT_PART_INSTALL/lib
      mkdir -p $SNAPCRAFT_PART_INSTALL/share/opentoonz
      cp -a stuff $SNAPCRAFT_PART_INSTALL/share/opentoonz
    #source-subdir: "toonz/sources"
    build-packages:
      - build-essential
      - cmake
      - pkg-config
      - libboost-all-dev
      - qt5-default
      - qtbase5-dev
      - libqt5svg5-dev
      - qtscript5-dev
      - qttools5-dev-tools
      - libqt5opengl5-dev
      - libsuperlu-dev
      - liblz4-dev
      - libusb-1.0-0-dev
      - liblzo2-dev
      - libjpeg-dev
      - libglew-dev
      - freeglut3-dev
      - libsdl2-dev
      - libfreetype6-dev
      - qtmultimedia5-dev
      - libqt5multimedia5
    stage-packages:
      - libglu1-mesa
      - ffmpeg
      - libpulse0
      - gstreamer1.0-plugins-ugly
      - gstreamer1.0-plugins-good
      - gstreamer1.0-plugins-bad
      - libqt5multimedia5-plugins
  desktop-qt5:
      build-packages:
        - qtbase5-dev
        - dpkg-dev
      make-parameters:
        - FLAVOR=qt5
      plugin: make
      source: https://github.com/ubuntu/snapcraft-desktop-helpers.git
      source-subdir: qt
      stage-packages:
        - libxkbcommon0
        - ttf-ubuntu-font-family
        - dmz-cursor-theme
        - light-themes
        - adwaita-icon-theme
        - gnome-themes-standard
        - shared-mime-info
        - libqt5gui5
        - libgdk-pixbuf2.0-0
        - libqt5svg5
        - locales-all
        - xdg-user-dirs
